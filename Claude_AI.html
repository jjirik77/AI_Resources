<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Claude.ai Interface Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .chat-container::-webkit-scrollbar,
        .workspace-container::-webkit-scrollbar {
            width: 8px;
        }
        .chat-container::-webkit-scrollbar-track,
        .workspace-container::-webkit-scrollbar-track {
            background: #f1f5f9; /* Tailwind slate-100 equivalent */
        }
        .chat-container::-webkit-scrollbar-thumb,
        .workspace-container::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* Tailwind slate-300 equivalent */
            border-radius: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb:hover,
        .workspace-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* Tailwind slate-500 equivalent */
        }
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #1e293b; /* Tailwind slate-900 equivalent */
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #475569; /* Tailwind slate-700 equivalent */
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* Tailwind slate-600 equivalent */
        }
        .highlight-on-copy {
            transition: background-color 0.3s ease;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* Styles for the '+' button submenu (attach options) */
        #attach-options-menu {
            position: absolute;
            bottom: calc(100% + 10px); /* Position above the input field */
            left: 20px; /* Aligned with the '+' button */
            width: fit-content;
            min-width: 280px;
            max-width: 90%;
            background-color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 8px;
            z-index: 10;
        }
        .dark #attach-options-menu {
            background-color: #334155; /* Tailwind slate-700 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        /* Styles for the '=' button submenu (tools/functions) */
        #tools-options-menu {
            position: absolute;
            bottom: calc(100% + 10px); /* Position above the input field */
            left: 60px; /* Aligned with the '=' button */
            width: fit-content;
            min-width: 280px;
            max-width: 90%;
            background-color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 8px;
            z-index: 10;
        }
        .dark #tools-options-menu {
            background-color: #334155; /* Tailwind slate-700 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        /* Common styles for submenu items */
        .submenu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            color: #1e293b; /* slate-900 */
            text-align: left;
        }
        .dark .submenu-item {
            color: #cbd5e1; /* slate-300 */
        }
        .submenu-item:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .dark .submenu-item:hover {
            background-color: #475569; /* slate-700 */
        }


        /* Specific styles for the model dropdown inside the input bar */
        #input-model-dropdown-container {
            position: relative;
            display: inline-block;
            margin-right: 8px; /* Space between model and send button */
        }
        #input-model-dropdown-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem; /* Smaller gap for tighter fit in input bar */
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 0.25rem 0.5rem; /* Smaller padding */
            border-radius: 0.375rem; /* Slightly smaller radius */
            color: inherit;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
        }
        #input-model-dropdown-btn:hover {
            background-color: #e2e8f0; /* Tailwind slate-200 */
            color: #1e293b; /* Tailwind slate-900 */
        }
        .dark #input-model-dropdown-btn:hover {
            background-color: #475569; /* Tailwind slate-700 */
            color: #cbd5e1; /* Tailwind slate-300 */
        }
        #input-model-options {
            position: absolute;
            bottom: calc(100% + 5px); /* Position above the button */
            right: 0; /* Align right within the input bar */
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 0.5rem;
            z-index: 20;
            min-width: 150px;
            text-align: left;
        }
        .dark #input-model-options {
            background-color: #334155; /* Tailwind slate-700 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        #input-model-options button {
            width: 100%;
            text-align: left;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
            color: #1e293b; /* slate-900 */
        }
        .dark #input-model-options button {
            color: #cbd5e1; /* slate-300 */
        }
        #input-model-options button:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .dark #input-model-options button:hover {
            background-color: #475569; /* Tailwind slate-700 */
        }
        #input-model-options button.selected {
            background-color: #e0f2fe; /* sky-100 */
            font-weight: 600;
            color: #0284c7; /* sky-600 */
        }
        .dark #input-model-options button.selected {
            background-color: #0c4a6e; /* sky-900 */
            color: #bae6fd; /* sky-200 */
        }

        /* Styles for the contextual quick action buttons */
        .quick-actions-bar {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* Full rounded */
            background-color: #f1f5f9; /* Tailwind slate-100 */
            color: #475569; /* Tailwind slate-600 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            border: 1px solid #cbd5e1; /* Tailwind slate-300 */
            transition: all 0.2s ease-in-out;
        }
        .dark .quick-action-btn {
            background-color: #1e293b; /* Tailwind slate-900 */
            color: #94a3b8; /* Tailwind slate-400 */
            border: 1px solid #334155; /* Tailwind slate-700 */
        }
        .quick-action-btn:hover {
            background-color: #e2e8f0; /* Tailwind slate-200 */
            border-color: #94a3b8; /* Tailwind slate-400 */
            color: #1e293b; /* Tailwind slate-900 */
        }
        .dark .quick-action-btn:hover {
            background-color: #334155; /* Tailwind slate-700 */
            border-color: #64748b; /* Tailwind slate-600 */
            color: #cbd5e1; /* Tailwind slate-300 */
        }

        /* New modal positioning for less intrusive notifications */
        #simulated-modal {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 300px; /* Smaller width */
            z-index: 100; /* Ensure it's on top */
            text-align: center;
            display: flex; /* Use flex for centering content */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0; /* Start hidden */
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allow clicks through when hidden */
        }
        #simulated-modal.visible {
            opacity: 1;
            pointer-events: auto; /* Enable clicks when visible */
        }
        .dark #simulated-modal {
            background-color: #334155; /* Tailwind slate-700 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        #simulated-modal #modal-title {
            font-size: 1rem; /* Smaller title */
            margin-bottom: 0.5rem;
        }
        #simulated-modal #modal-message {
            font-size: 0.875rem; /* Smaller message text */
            margin-bottom: 1rem;
        }
        #simulated-modal #modal-close-btn {
            padding: 0.3rem 0.8rem; /* Smaller close button */
            font-size: 0.8rem;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-gray-900 text-slate-800 dark:text-slate-200">

    <div id="app-container" class="flex h-screen w-screen overflow-hidden">
        
        <aside id="sidebar" class="bg-slate-900 text-white w-64 p-3 flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out sidebar overflow-y-auto">
            <div class="sidebar-header mb-6">
                <div class="text-xl font-bold mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-sparkles text-sky-400"></i> Claude
                </div>
                <button id="new-chat-btn" class="w-full flex items-center gap-2 p-2 rounded-lg hover:bg-slate-700 transition-colors justify-start">
                    <i class="fa-solid fa-plus text-xs"></i>
                    <span>New chat</span>
                </button>
            </div>
            <nav id="sidebar-nav-main" class="flex-grow">
                <ul class="space-y-1 mb-4">
                    <li>
                        <button id="chats-sidebar-link" class="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-slate-700 cursor-pointer text-sm">
                            <i class="fa-solid fa-message"></i>
                            <span>Chats</span>
                        </button>
                    </li>
                    <li>
                        <button id="artifacts-sidebar-link" class="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-slate-700 cursor-pointer text-sm">
                            <i class="fa-solid fa-shapes"></i> <span>Artifacts</span>
                        </button>
                    </li>
                </ul>

                <div id="recent-chats-section" class="mt-4">
                    <div class="flex items-center justify-between px-2 py-1">
                        <p class="text-xs text-slate-500 font-semibold select-none">Recents</p>
                        <button id="search-toggle-btn" class="text-slate-500 hover:text-white transition-colors">
                            <i class="fa-solid fa-search text-xs"></i>
                        </button>
                    </div>
                    <div id="sidebar-search-area" class="px-2 py-1 hidden">
                        <div class="relative mb-1">
                            <input type="text" id="chat-search-input" placeholder="Search chats..." class="w-full pl-8 pr-8 py-1 rounded-md bg-slate-800 text-white border border-slate-700 focus:outline-none focus:border-sky-500 text-sm">
                            <i class="fa-solid fa-magnifying-glass absolute left-2 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <button id="clear-search-btn" class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white hidden">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                    </div>
                    <ul id="chat-list" class="space-y-1 mt-1">
                        <p class="text-xs text-slate-500 px-2 mt-2">No recent chats. Start a new one!</p>
                    </ul>
                </div>
            </nav>
            <div class="sidebar-footer pt-2 border-t border-slate-700">
                <button id="user-profile-btn" class="w-full flex items-center justify-between p-2 rounded-lg hover:bg-slate-700 cursor-pointer text-sm mb-1">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-sky-500 rounded-full flex items-center justify-center font-bold text-white text-sm">U</div>
                        <span class="font-semibold text-left">
                            <p>User Name</p>
                            <p class="text-xs text-slate-400">Free plan</p>
                        </span>
                    </div>
                    <i class="fa-solid fa-chevron-down text-xs text-slate-500"></i>
                </button>
            </div>
        </aside>

        <main id="chat-area" class="flex-1 flex flex-col bg-white dark:bg-slate-800 transition-all duration-300 ease-in-out">
            <header class="chat-header flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700">
                <button id="sidebar-toggle-btn" class="text-slate-500 hover:text-slate-800 dark:hover:text-slate-200 mr-2">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <div class="flex-1 text-center text-lg font-semibold text-slate-700 dark:text-slate-200">
                    <h1 class="text-3xl md:text-4xl font-bold text-slate-700 dark:text-slate-200 mb-0 flex items-center justify-center gap-4">
                        <i class="fa-solid fa-sparkles text-sky-500"></i> Good morning, User
                    </h1>
                </div>
                <div></div> 
            </header>

            <div id="message-container" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 chat-container">
                <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center">
                    </div>
            </div>
            
            <div id="typing-indicator" class="px-6 py-2 text-slate-500 italic hidden">
                <span>Claude is thinking...</span>
            </div>

            <footer class="chat-input-area p-4 md:p-6 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700">
                <div class="max-w-4xl mx-auto">
                    <div class="relative flex items-end bg-slate-100 dark:bg-slate-700 rounded-xl py-4 px-4"> 
                        <button id="attach-button" class="p-2 text-slate-500 hover:text-slate-800 dark:hover:text-slate-200 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600" title="Add files or options">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                        <button id="tools-button" class="p-2 text-slate-500 hover:text-slate-800 dark:hover:text-slate-200 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600 mr-1" title="Access functions">
                            <i class="fa-solid fa-equals"></i>
                        </button>
                        <textarea id="prompt-input" rows="1" placeholder="How can I help you today?" class="flex-1 bg-transparent resize-none focus:outline-none placeholder-slate-400 dark:placeholder-slate-500 max-h-40 overflow-y-auto"></textarea>
                        
                        <div id="input-model-dropdown-container" class="relative">
                            <button id="input-model-dropdown-btn" class="flex items-center">
                                <span id="input-current-model-display">Sonnet 4</span>
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </button>
                            <div id="input-model-options" class="hidden">
                                <button data-model-id="claude-opus" class="model-option">Claude 3 Opus (Pro Plan)</button>
                                <button data-model-id="claude-sonnet" class="model-option selected">Claude 3 Sonnet</button>
                            </div>
                        </div>

                        <button id="send-btn" class="p-2 rounded-full bg-sky-600 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors" title="Send message">
                            <i class="fa-solid fa-arrow-up"></i>
                        </button>

                        <!-- Submenu for '+' button (Attach/Add options) -->
                        <div id="attach-options-menu" class="chat-options-menu hidden">
                            <ul class="flex flex-col space-y-1">
                                <li>
                                    <button class="submenu-item w-full" data-action="Attach Files">
                                        <i class="fa-solid fa-paperclip w-5"></i> Attach files...
                                    </button>
                                </li>
                                <li>
                                    <button class="submenu-item w-full" data-action="Upload Folder">
                                        <i class="fa-solid fa-folder-open w-5"></i> Upload folder...
                                    </button>
                                </li>
                                <li>
                                    <button class="submenu-item w-full" data-action="Take Screenshot">
                                        <i class="fa-solid fa-camera w-5"></i> Take screenshot
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <!-- Submenu for '=' button (Tools/Functions) -->
                        <div id="tools-options-menu" class="chat-options-menu hidden">
                            <ul class="flex flex-col space-y-1">
                                <li>
                                    <button class="submenu-item w-full" data-action="Use a Tool">
                                        <i class="fa-solid fa-wrench w-5"></i> Use a tool...
                                    </button>
                                </li>
                                <li>
                                    <button class="submenu-item w-full" data-action="Add to Library">
                                        <i class="fa-solid fa-bookmark w-5"></i> Add to library...
                                    </button>
                                </li>
                                <li class="border-t border-slate-200 dark:border-slate-600 my-1 py-1"></li>
                                <li>
                                    <button class="submenu-item w-full" data-action="Search the Web">
                                        <i class="fa-solid fa-globe w-5"></i> Search the web
                                    </button>
                                </li>
                                <li>
                                    <button class="submenu-item w-full" data-action="Run Deep Research">
                                        <i class="fa-solid fa-flask w-5"></i> Run deep research
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <p class="text-xs text-center text-slate-400 dark:text-slate-500 mt-2">Claude can make mistakes. Consider checking important information.</p>
                </div>
            </footer>
            <div id="quick-actions-bar" class="quick-actions-bar">
                <button class="quick-action-btn" data-prompt-trigger="Write" title="Pre-fills the input with a 'Write' prompt, prompting Claude to assist with creative writing, drafting, or editing tasks.">
                    <i class="fa-solid fa-pen"></i> Write
                </button>
                <button class="quick-action-btn" data-prompt-trigger="Learn" title="Pre-fills the input with a 'Learn' prompt, prompting Claude to provide explanations, summaries, or educational content on a topic.">
                    <i class="fa-solid fa-book-open"></i> Learn
                </button>
                <button class="quick-action-btn" data-prompt-trigger="Code" title="Pre-fills the input with a 'Code' prompt, prompting Claude to assist with generating, debugging, or reviewing code.">
                    <i class="fa-solid fa-code"></i> Code
                </button>
                <button class="quick-action-btn" data-prompt-trigger="Life stuff" title="Pre-fills the input with a 'Life stuff' prompt, prompting Claude to help with daily tasks, personal organization, or general advice.">
                    <i class="fa-solid fa-bowl-food"></i> Life stuff
                </button>
                <button class="quick-action-btn" data-prompt-trigger="Claude's choice" title="Pre-fills the input with a prompt for Claude to suggest what to do next based on its capabilities or your conversation history.">
                    <i class="fa-solid fa-hand-sparkles"></i> Claude's choice
                </button>
            </div>
        </main>

        <div id="workspace-panel" class="w-0 flex-shrink-0 bg-slate-100 dark:bg-slate-700 border-l border-slate-200 dark:border-slate-700 overflow-y-auto transition-all duration-300 ease-in-out hidden">
            <div class="p-4 flex items-center justify-between border-b border-slate-200 dark:border-slate-600">
                <h3 class="text-md font-semibold text-slate-800 dark:text-slate-200">Workspace / Artifacts</h3>
                <button id="close-workspace-btn" class="text-slate-500 hover:text-slate-800 dark:hover:text-slate-200">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div id="workspace-content" class="p-4 text-slate-700 dark:text-slate-300 workspace-container">
                <p class="text-sm italic text-slate-500 dark:text-slate-400">Content generated for specific tasks (e.g., code, markdown files, data visualizations) would appear here, alongside the chat.</p>
                <div id="example-artifact" class="hidden mt-4 p-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800">
                    <h4 class="font-semibold mb-2">Generated Markdown File:</h4>
                    <pre class="text-sm bg-slate-100 dark:bg-slate-900 p-3 rounded overflow-x-auto"># Project Proposal

## Introduction
This is a sample markdown file generated by Claude, demonstrating its ability to create structured documents.

## Objectives
* Objective 1
* Objective 2

## Timeline
Week 1: Planning
Week 2: Development</pre>
                    <button class="download-artifact-btn mt-2 px-3 py-1 bg-sky-500 text-white rounded-md text-sm hover:bg-sky-600 transition-colors">Download</button>
                </div>
            </div>
        </div>
    </div>

    <div id="simulated-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white dark:bg-slate-700 p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <h3 class="text-lg font-semibold mb-4 text-slate-800 dark:text-slate-100" id="modal-title"></h3>
            <p class="text-slate-600 dark:text-slate-300 mb-6" id="modal-message"></p>
            <button id="modal-close-btn" class="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
            const newChatBtn = document.getElementById('new-chat-btn');
            const chatList = document.getElementById('chat-list');
            const sidebarNavMain = document.getElementById('sidebar-nav-main');

            const messageContainer = document.getElementById('message-container');
            const promptInput = document.getElementById('prompt-input');
            const sendBtn = document.getElementById('send-btn');
            const welcomeScreen = document.getElementById('welcome-screen');
            const typingIndicator = document.getElementById('typing-indicator');

            // Input Area elements
            const attachButton = document.getElementById('attach-button');
            const toolsButton = document.getElementById('tools-button');
            const attachOptionsMenu = document.getElementById('attach-options-menu'); // New: specific for '+'
            const toolsOptionsMenu = document.getElementById('tools-options-menu');   // New: specific for '='
            const submenuItems = document.querySelectorAll('.submenu-item'); // Common class for items in both new submenus

            // Model selection elements (inside input bar)
            const inputModelDropdownContainer = document.getElementById('input-model-dropdown-container');
            const inputModelDropdownBtn = document.getElementById('input-model-dropdown-btn');
            const inputCurrentModelDisplay = document.getElementById('input-current-model-display');
            const inputModelOptions = document.getElementById('input-model-options');
            const inputModelOptionButtons = document.querySelectorAll('#input-model-options .model-option');

            // Sidebar specific buttons and elements
            const chatsSidebarLink = document.getElementById('chats-sidebar-link');
            const artifactsSidebarLink = document.getElementById('artifacts-sidebar-link');
            const searchToggleBtn = document.getElementById('search-toggle-btn');
            const sidebarSearchArea = document.getElementById('sidebar-search-area');
            const chatSearchInput = document.getElementById('chat-search-input');
            const clearSearchBtn = document.getElementById('clear-search-btn');
            const userProfileBtn = document.getElementById('user-profile-btn');

            // Workspace Panel elements
            const workspacePanel = document.getElementById('workspace-panel');
            const closeWorkspaceBtn = document.getElementById('close-workspace-btn');
            const workspaceContent = document.getElementById('workspace-content');
            const exampleArtifact = document.getElementById('example-artifact');

            // Contextual Quick Action Buttons
            const quickActionsBar = document.getElementById('quick-actions-bar');
            const quickActionButtons = document.querySelectorAll('.quick-action-btn');

            const simulatedModal = document.getElementById('simulated-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            let chatHistory = [];
            let activeChatId = null;
            let currentModel = 'claude-sonnet'; // Default Claude model

            const simulatedResponses = {
                "claude-sonnet": {
                    "hello": "Hello! I am Claude 3 Sonnet, designed for quick, balanced performance and strong reasoning. How can I assist you today?",
                    "help": "I can help with various tasks, from generating code and creative text to summarizing documents and answering complex questions. What's on your mind?",
                    "code": "Certainly. As Claude 3 Sonnet, I can generate clear and functional code snippets. What programming language or problem are you working on?",
                    "summarize": "I excel at summarizing lengthy texts while preserving key information. Please provide the document or text you'd like me to summarize.",
                    "write": "I enjoy creative tasks! Tell me what you're imagining. I can help with stories, poems, scripts, or even just brainstorming ideas.",
                    "learn": "I can help you understand new concepts or summarize complex topics. What would you like to learn about?",
                    "life stuff": "I can assist with practical daily tasks, like drafting emails, creating lists, or giving advice on common situations. What do you need help with in your daily life?",
                    "claude's choice": "Based on our interaction so far, I suggest we explore [suggested topic]. Or, feel free to ask me anything you like!",
                    "research analysis": "I'm adept at analyzing information for research. What topic are you exploring? I can help synthesize data and identify key insights.",
                    "document q&a": "Please upload or paste your document. I can read through it and answer specific questions you have about its content.",
                    "attach files": "Claude 3 Sonnet can process various file types (e.g., PDF, DOCX, TXT) up to 30MB. How can I help analyze your file?",
                    "project proposal": "Generating a project proposal based on your input. This will appear as an 'Artifact' in the workspace panel to your right.",
                    "default": "Thank you for your prompt. As Claude 3 Sonnet, I strive to provide helpful and harmless responses. Could you elaborate a bit more on what you're looking for?"
                },
                "claude-opus": {
                    "hello": "Greetings! I am Claude 3 Opus, Anthropic's most intelligent model for highly complex tasks. How may I be of service?",
                    "help": "As Claude 3 Opus, my capabilities extend to deeply nuanced reasoning, multi-step problem-solving, and handling highly intricate information. I can integrate information from vast contexts and provide expert-level insights across domains. What grand challenge can I tackle for you?",
                    "code": "With Claude 3 Opus, I can generate, debug, and refactor complex codebases, understand intricate architectural patterns, and even perform cross-language transformations. What is the scope of your coding challenge?",
                    "summarize": "I can provide highly detailed and nuanced summaries, extracting not just information but also underlying themes, arguments, and implications from very long or complex documents. Please provide the material.",
                    "write": "As Claude 3 Opus, I can engage in advanced creative collaboration, generating sophisticated narratives, dialogues, and poetic structures with deep thematic coherence and stylistic versatility. Let's create something extraordinary.",
                    "learn": "I am equipped for deep dives into complex subjects, providing comprehensive explanations and structured learning paths. What concept or field interests you today?",
                    "life stuff": "I can offer detailed and structured assistance with personal and professional tasks, from planning events to organizing information. How can I help streamline your life?",
                    "claude's choice": "Given your previous inputs and my advanced capabilities, I recommend we delve into [more advanced suggested topic]. I'm ready for a challenging discussion!",
                    "research analysis": "My research analysis capabilities include synthesizing information from multiple, disparate sources, identifying subtle connections, evaluating methodologies, and formulating novel hypotheses. What complex research problem are we solving?",
                    "document q&a": "Claude 3 Opus can perform in-depth analysis of extremely large and complex documents, including visual understanding of PDFs. Ask me anything, and I will find the most relevant and insightful answers within your provided files.",
                    "attach files": "Claude 3 Opus can handle large and diverse file inputs, including deep visual understanding of PDFs and other image-rich documents, up to 30MB. How can I leverage this capability for you?",
                    "project proposal": "Engaging Claude 3 Opus for a comprehensive project proposal. Expect detailed sections, robust arguments, and a clear outline, which will be presented as an 'Artifact' in the workspace panel to your right.",
                    "default": "Thank you for your inquiry. As Claude 3 Opus, I am designed to reason with the highest level of intelligence for the most demanding tasks. I prioritize safety and helpfulness in all responses. How can I provide the most valuable assistance on this topic?"
                }
            };

            const showModal = (title, message) => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                simulatedModal.classList.add('visible'); // Use 'visible' class for opacity transition
                setTimeout(() => {
                    simulatedModal.classList.remove('visible');
                }, 3000); // Auto-hide after 3 seconds
            };

            modalCloseBtn.addEventListener('click', () => {
                simulatedModal.classList.remove('visible');
            });

            const saveHistory = () => {
                localStorage.setItem('claudeChatHistory', JSON.stringify(chatHistory));
                localStorage.setItem('claudeActiveChatId', activeChatId);
                localStorage.setItem('claudeCurrentModel', currentModel);
            };

            const loadHistory = () => {
                const savedHistory = localStorage.getItem('claudeChatHistory');
                const savedActiveId = localStorage.getItem('claudeActiveChatId');
                const savedModel = localStorage.getItem('claudeCurrentModel');

                if (savedHistory) {
                    chatHistory = JSON.parse(savedHistory);
                    activeChatId = savedActiveId ? savedActiveId : (chatHistory.length > 0 ? chatHistory[0].id : null);
                    if (savedModel) {
                        currentModel = savedModel;
                    }
                    renderChatList();
                    updateModelDisplay(currentModel);
                    if (activeChatId) {
                        loadChat(activeChatId);
                    }
                } else {
                    chatHistory = [];
                    renderChatList();
                }
            };

            const renderChatList = (searchTerm = '') => {
                chatList.innerHTML = '';

                const filteredChatHistory = chatHistory.filter(chat =>
                    chat.title.toLowerCase().includes(searchTerm.toLowerCase())
                ).sort((a, b) => b.timestamp - a.timestamp); // Sort by most recent

                if (searchTerm.length > 0) {
                    sidebarSearchArea.classList.remove('hidden'); // Ensure search area is visible
                    clearSearchBtn.classList.remove('hidden');
                } else {
                    // Only hide search area if it's currently visible AND the search input is empty.
                    // This prevents it from hiding immediately if you just type then clear without hitting search button
                    if (sidebarSearchArea.classList.contains('hidden') === false && chatSearchInput.value.trim() === '') {
                        sidebarSearchArea.classList.add('hidden');
                        clearSearchBtn.classList.add('hidden');
                    }
                }
                
                if (filteredChatHistory.length === 0 && searchTerm.length === 0) {
                    chatList.innerHTML = '<p class="text-xs text-slate-500 px-2 mt-2">No recent chats. Start a new one!</p>';
                } else if (filteredChatHistory.length === 0 && searchTerm.length > 0) {
                    chatList.innerHTML = '<p class="text-xs text-slate-500 px-2 mt-2">No matching chats found.</p>';
                } else {
                    filteredChatHistory.forEach(chat => {
                        const li = createChatListItem(chat);
                        chatList.appendChild(li);
                    });
                }

                document.querySelectorAll('.chat-history-item').forEach(btn => {
                    if (btn.dataset.chatId === activeChatId) {
                        btn.classList.add('bg-slate-700');
                    } else {
                        btn.classList.remove('bg-slate-700');
                    }
                });
            };

            const createChatListItem = (chat) => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.className = `chat-history-item w-full flex items-center gap-3 p-2 rounded-lg hover:bg-slate-700 transition-colors text-sm truncate group flex items-center justify-between`;
                btn.innerHTML = `
                    <span class="flex items-center gap-3 truncate"><i class="fa-solid fa-message"></i><span class="truncate">${chat.title}</span></span>
                    <div class="chat-actions hidden group-hover:flex items-center gap-1">
                        <button class="edit-chat-title-btn p-1 rounded-md hover:bg-slate-600" title="Edit chat title" data-chat-id="${chat.id}"><i class="fa-solid fa-pen text-xs"></i></button>
                        <button class="delete-chat-btn p-1 rounded-md hover:bg-slate-600" title="Delete chat" data-chat-id="${chat.id}"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                `;
                btn.dataset.chatId = chat.id;

                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (e.target.closest('.edit-chat-title-btn') || e.target.closest('.delete-chat-btn')) {
                        return;
                    }
                    activeChatId = chat.id;
                    loadChat(chat.id);
                    renderChatList();
                });

                btn.querySelector('.edit-chat-title-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const chatIdToEdit = e.currentTarget.dataset.chatId;
                    const chatToEdit = chatHistory.find(c => c.id === chatIdToEdit);
                    if (chatToEdit) {
                        const newTitle = prompt('Edit chat title:', chatToEdit.title);
                        if (newTitle !== null && newTitle.trim() !== '') {
                            chatToEdit.title = newTitle.trim();
                            saveHistory();
                            renderChatList();
                        }
                    }
                });

                btn.querySelector('.delete-chat-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const chatIdToDelete = e.currentTarget.dataset.chatId;
                    const chatToEdit = chatHistory.find(c => c.id === chatIdToDelete);
                    if (chatToEdit && confirm(`Are you sure you want to delete "${chatToEdit.title}"? This action is usually permanent.`)) {
                        chatHistory = chatHistory.filter(c => c.id !== chatIdToDelete);
                        if (activeChatId === chatIdToDelete) {
                            activeChatId = chatHistory.length > 0 ? chatHistory[0].id : null;
                        }
                        saveHistory();
                        renderChatList();
                        if (activeChatId) {
                            loadChat(activeChatId);
                        } else {
                            startNewChat();
                        }
                    }
                });
                li.appendChild(btn);
                return li;
            };

            const loadChat = (chatId) => {
                const chat = chatHistory.find(c => c.id === chatId);
                if (chat) {
                    activeChatId = chatId;
                    messageContainer.innerHTML = '';
                    chat.messages.forEach(msg => addMessageToUI(msg.sender, msg.content, false, msg.id));
                    welcomeScreen.classList.add('hidden');
                    quickActionsBar.classList.add('hidden'); // Hide quick actions when a specific chat is loaded
                    scrollToBottom();
                }
            };

            const startNewChat = () => {
                activeChatId = null;
                messageContainer.innerHTML = '';
                welcomeScreen.classList.remove('hidden');
                promptInput.value = '';
                sendBtn.disabled = true;
                promptInput.style.height = 'auto';
                renderChatList();
                attachOptionsMenu.classList.add('hidden'); // Close attach options menu if open
                toolsOptionsMenu.classList.add('hidden'); // Close tools options menu if open
                inputModelOptions.classList.add('hidden'); // Close model options if open
                workspacePanel.classList.add('w-0', 'hidden');
                workspacePanel.classList.remove('w-1/3');
                exampleArtifact.classList.add('hidden');
                quickActionsBar.classList.remove('hidden'); // Show quick actions on new chat/welcome
            };

            const addMessageToUI = (sender, content, isStreaming, messageId = `msg_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`) => {
                const messageWrapper = document.createElement('div');
                messageWrapper.className = `flex gap-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                messageWrapper.dataset.messageId = messageId;
                messageWrapper.dataset.sender = sender;
                
                const icon = document.createElement('div');
                icon.className = `w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center font-bold ${sender === 'user' ? 'bg-sky-600 text-white' : 'bg-slate-900 dark:bg-white'}`;
                icon.innerHTML = sender === 'user' ? 'U' : `<i class="fa-solid fa-sparkles ${sender === 'user' ? '' : 'text-white dark:text-slate-900'}"></i>`;
                
                const messageContentArea = document.createElement('div');
                messageContentArea.className = `max-w-xl flex flex-col`;

                const messageBubble = document.createElement('div');
                messageBubble.className = `p-4 rounded-xl ${sender === 'user' ? 'bg-sky-600 text-white rounded-br-none' : 'bg-slate-100 dark:bg-slate-700 rounded-bl-none'}`;
                
                if (sender === 'ai') {
                    const renderedContent = renderMarkdown(content);
                    messageBubble.innerHTML = renderedContent;
                } else {
                    const p = document.createElement('p');
                    p.textContent = content;
                    messageBubble.appendChild(p);
                }
                
                messageContentArea.appendChild(messageBubble);

                if (sender === 'ai') {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'flex items-center gap-2 mt-2 ml-auto text-slate-500 dark:text-slate-400 text-sm';
                    
                    const regenerateBtn = document.createElement('button');
                    regenerateBtn.className = 'p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600 flex items-center gap-1';
                    regenerateBtn.innerHTML = '<i class="fa-solid fa-arrow-rotate-right"></i> Regenerate';
                    regenerateBtn.title = 'Regenerate response';
                    regenerateBtn.addEventListener('click', () => showModal('Regenerate Response', 'Requests Claude to generate an alternative or revised response to your last prompt.'));

                    const thumbsUpBtn = document.createElement('button');
                    thumbsUpBtn.className = 'p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600';
                    thumbsUpBtn.innerHTML = '<i class="fa-regular fa-thumbs-up"></i>';
                    thumbsUpBtn.title = 'Good Response';
                    thumbsUpBtn.addEventListener('click', () => showModal('Feedback', 'Provides positive feedback to Anthropic on the quality and helpfulness of Claude\'s response.'));

                    const thumbsDownBtn = document.createElement('button');
                    thumbsDownBtn.className = 'p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600';
                    thumbsDownBtn.innerHTML = '<i class="fa-regular fa-thumbs-down"></i>';
                    thumbsDownBtn.title = 'Bad Response';
                    thumbsDownBtn.addEventListener('click', () => showModal('Feedback', 'Provides negative feedback to Anthropic on the quality or safety of Claude\'s response.'));

                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600';
                    copyBtn.innerHTML = '<i class="fa-regular fa-clipboard"></i>';
                    copyBtn.title = 'Copy';
                    copyBtn.addEventListener('click', () => {
                        const textToCopy = messageBubble.innerText;
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            showModal('Copied!', 'Copies Claude\'s generated response (including text and code) to your clipboard, preserving formatting.');
                        }).catch(err => {
                            showModal('Error', 'Failed to copy response.');
                            console.error('Failed to copy: ', err);
                        });
                    });

                    actionsDiv.appendChild(regenerateBtn);
                    actionsDiv.appendChild(thumbsUpBtn);
                    actionsDiv.appendChild(thumbsDownBtn);
                    actionsDiv.appendChild(copyBtn);
                    messageContentArea.appendChild(actionsDiv);
                } else {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'flex items-center gap-2 mt-2 mr-auto text-slate-500 dark:text-slate-400 text-sm';

                    const editPromptBtn = document.createElement('button');
                    editPromptBtn.className = 'p-1 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600 flex items-center gap-1';
                    editPromptBtn.innerHTML = '<i class="fa-solid fa-pen"></i> Edit';
                    editPromptBtn.title = 'Edit prompt';
                    editPromptBtn.addEventListener('click', () => showModal('Edit Prompt', 'Allows you to modify your previously sent prompt. Claude will then generate a new response based on the edited input.'));
                    actionsDiv.appendChild(editPromptBtn);
                    messageContentArea.appendChild(actionsDiv);
                }

                if (sender === 'user') {
                    messageWrapper.appendChild(messageContentArea);
                    messageWrapper.appendChild(icon);
                } else {
                    messageWrapper.appendChild(icon);
                    messageWrapper.appendChild(messageContentArea);
                }
                
                messageContainer.appendChild(messageWrapper);
                if(isStreaming) {
                    scrollToBottom();
                }

                if (sender === 'ai') {
                    attachCodeCopyListeners(messageBubble);
                    if (content.includes("This will appear as an 'Artifact'")) {
                        workspacePanel.classList.remove('w-0', 'hidden');
                        workspacePanel.classList.add('w-1/3');
                        exampleArtifact.classList.remove('hidden');
                        showModal('Workspace Update', 'Claude has generated an "Artifact" which is displayed in the new workspace panel on the right.');
                    }
                }
            };

            const handleSendMessage = () => {
                const prompt = promptInput.value.trim();
                if (!prompt) return;

                welcomeScreen.classList.add('hidden');
                attachOptionsMenu.classList.add('hidden'); // Hide attach options menu when message sent
                toolsOptionsMenu.classList.add('hidden'); // Hide tools options menu when message sent
                inputModelOptions.classList.add('hidden'); // Close model options if open
                quickActionsBar.classList.add('hidden'); // Hide quick actions bar on message sent
                
                let currentChat = chatHistory.find(c => c.id === activeChatId);
                if (!currentChat) {
                    activeChatId = `chat_${Date.now()}`;
                    currentChat = { id: activeChatId, title: prompt.substring(0, 30), messages: [], timestamp: Date.now() };
                    chatHistory.push(currentChat);
                }
                
                currentChat.messages.push({ sender: 'user', content: prompt, id: `msg_${Date.now()}_${Math.random().toString(36).substring(2, 9)}` });
                addMessageToUI('user', prompt, true);

                promptInput.value = '';
                sendBtn.disabled = true;
                promptInput.style.height = 'auto';

                renderChatList();
                saveHistory();
                simulateAIResponse(prompt);
            };

            const simulateAIResponse = (prompt) => {
                typingIndicator.classList.remove('hidden');
                scrollToBottom();

                setTimeout(() => {
                    typingIndicator.classList.add('hidden');
                    const model = currentModel;
                    // Determine which response to give based on keywords
                    const promptLower = prompt.toLowerCase();
                    const promptKey = promptLower.includes('hello') ? 'hello' :
                                      promptLower.includes('help') ? 'help' :
                                      promptLower.includes('code') ? 'code' :
                                      promptLower.includes('summarize') ? 'summarize' :
                                      promptLower.includes('write') ? 'write' :
                                      promptLower.includes('learn') ? 'learn' :
                                      promptLower.includes('life stuff') ? 'life stuff' :
                                      promptLower.includes("claude's choice") ? "claude's choice" :
                                      promptLower.includes('research') ? 'research analysis' :
                                      promptLower.includes('document q&a') || promptLower.includes('document') ? 'document q&a' :
                                      promptLower.includes('attach files') || promptLower.includes('file') ? 'attach files' :
                                      promptLower.includes('project proposal') ? 'project proposal' :
                                      'default';

                    let response = simulatedResponses[model][promptKey];

                    let currentChat = chatHistory.find(c => c.id === activeChatId);
                    if (currentChat) {
                        currentChat.messages.push({ sender: 'ai', content: response, id: `msg_${Date.now()}_${Math.random().toString(36).substring(2, 9)}` });
                        addMessageToUI('ai', response, true);
                        saveHistory();
                    }
                }, 1500 + Math.random() * 1000);
            };

            const renderMarkdown = (text) => {
                let html = text;
                // Code blocks
                html = html.replace(/```(\w+)?\n([\s\S]*?)\n```/g, (match, lang, code) => {
                    const language = lang ? lang.charAt(0).toUpperCase() + lang.slice(1) : 'Code';
                    return `<div class="code-block bg-slate-800 rounded-lg my-2">
                                <div class="flex justify-between items-center px-4 py-2 bg-slate-900 rounded-t-lg">
                                    <span class="text-xs text-slate-400">${language}</span>
                                    <button class="copy-code-btn text-xs text-slate-400 hover:text-white flex items-center gap-1">
                                        <i class="fa-regular fa-clipboard"></i> Copy code
                                    </button>
                                </div>
                                <pre class="p-4 overflow-x-auto text-sm text-white"><code class="language-${lang || 'plaintext'} highlight-on-copy">${code.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre>
                            </div>`;
                });
                // Headings
                html = html.replace(/^### (.*$)/gim, '<h3 class="text-lg font-semibold my-2">$1</h3>');
                html = html.replace(/^## (.*$)/gim, '<h2 class="text-xl font-semibold my-2">$1</h2>');
                html = html.replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold my-2">$1</h1>');
                // Bold text
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                // Italic text
                html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
                // Unordered lists
                html = html.replace(/^\* (.*$)/gim, '<li class="ml-4">$1</li>')
                             .replace(/(<li>.*<\/li>(\n<li>.*<\/li>)*)/g, (match) => `<ul class="list-disc list-inside space-y-1 my-2">${match}</ul>`);
                // Ordered lists
                html = html.replace(/^\d+\. (.*$)/gim, '<li class="ml-4">$1</li>')
                             .replace(/(<li>.*<\/li>(\n<li>.*<\/li>)*)/g, (match) => `<ol class="list-decimal list-inside space-y-1 my-2">${match}</ol>`);
                
                // Blockquotes
                html = html.replace(/^> (.*$)/gim, '<blockquote class="border-l-4 border-slate-400 dark:border-slate-500 pl-4 italic my-2 text-slate-600 dark:text-slate-300">$1</blockquote>');

                // Convert remaining lines to paragraphs, but only if they are not already part of other tags
                html = html.split('\n').map(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine === '' || trimmedLine.startsWith('<') || trimmedLine.startsWith('&lt;') ||
                        trimmedLine.match(/^(?:<h[1-6]|<div|<p|<ul|<ol|<li|<blockquote)/i)) {
                        return line;
                    }
                    return `<p>${line}</p>`;
                }).join('');

                return html;
            };

            const attachCodeCopyListeners = (container) => {
                container.querySelectorAll('.copy-code-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const codeBlock = button.closest('.code-block');
                        const codeElement = codeBlock.querySelector('code');
                        const textToCopy = codeElement.innerText;
                        
                        document.execCommand('copy'); // Fallback for navigator.clipboard
                        // Original: navigator.clipboard.writeText(textToCopy).then(() => {
                        //     showModal('Copied!', 'Copies Claude\'s generated response (including text and code) to your clipboard, preserving formatting.');
                        // }).catch(err => {
                        //     showModal('Error', 'Failed to copy response. Please try again.');
                        //     console.error('Failed to copy: ', err);
                        // });
                        // Using execCommand for immediate feedback in this environment
                        const textarea = document.createElement('textarea');
                        textarea.value = textToCopy;
                        document.body.appendChild(textarea);
                        textarea.select();
                        try {
                            const successful = document.execCommand('copy');
                            const msg = successful ? 'Copied!' : 'Failed to copy. Please try again.';
                            showModal('Copied!', msg);
                        } catch (err) {
                            showModal('Error', 'Failed to copy response. Please try again.');
                            console.error('Fallback: Oops, unable to copy', err);
                        }
                        document.body.removeChild(textarea);

                    });
                });
            };

            const scrollToBottom = () => {
                messageContainer.scrollTop = messageContainer.scrollHeight;
            };
            
            promptInput.addEventListener('input', () => {
                sendBtn.disabled = promptInput.value.trim().length === 0;
                promptInput.style.height = 'auto';
                promptInput.style.height = (promptInput.scrollHeight) + 'px';
            });
            
            promptInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });

            document.addEventListener('click', (e) => {
                // Close attach options menu if click outside
                if (!attachOptionsMenu.contains(e.target) && !attachButton.contains(e.target)) {
                    attachOptionsMenu.classList.add('hidden');
                }
                // Close tools options menu if click outside
                if (!toolsOptionsMenu.contains(e.target) && !toolsButton.contains(e.target)) {
                    toolsOptionsMenu.classList.add('hidden');
                }
                // Close model options if click outside
                if (!inputModelOptions.contains(e.target) && !inputModelDropdownBtn.contains(e.target)) {
                    inputModelOptions.classList.add('hidden');
                }
                // Close sidebar search area if click outside and search input is empty
                if (!sidebarSearchArea.contains(e.target) && !searchToggleBtn.contains(e.target)) {
                     if (chatSearchInput.value.trim() === '') {
                        sidebarSearchArea.classList.add('hidden');
                        clearSearchBtn.classList.add('hidden');
                    }
                }
            });

            sendBtn.addEventListener('click', handleSendMessage);
            newChatBtn.addEventListener('click', startNewChat);

            sidebarToggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('w-64');
                sidebar.classList.toggle('w-0');
                sidebar.classList.toggle('p-3');
                sidebar.classList.toggle('p-0');
                if (sidebar.classList.contains('w-0')) {
                    sidebar.style.overflow = 'hidden';
                } else {
                    sidebar.style.overflow = 'auto';
                }
            });

            // Model dropdown behavior (now in input bar)
            inputModelDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                inputModelOptions.classList.toggle('hidden');
                // Ensure other submenus are closed
                attachOptionsMenu.classList.add('hidden');
                toolsOptionsMenu.classList.add('hidden');
                showModal('Model Selection', 'Choose between Claude 3 Sonnet (balanced) and Claude 3 Opus (most intelligent, Pro Plan required) for your conversation.');
            });

            inputModelOptionButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const newModel = button.dataset.modelId;
                    if (newModel === 'claude-opus' && currentModel === 'claude-sonnet') {
                        showModal('Pro Plan Feature', 'Claude 3 Opus is Anthropic\'s most powerful model, designed for complex tasks. It requires a Pro Plan subscription for access.');
                        return;
                    }
                    currentModel = newModel;
                    updateModelDisplay(currentModel);
                    inputModelOptions.classList.add('hidden');
                    saveHistory();
                    showModal('Model Selected', `You selected ${newModel === 'claude-sonnet' ? 'Claude 3 Sonnet' : 'Claude 3 Opus'}.`);
                });
            });

            const updateModelDisplay = (modelId) => {
                const displayModel = modelId === 'claude-sonnet' ? 'Sonnet 4' : 'Opus 4';
                inputCurrentModelDisplay.textContent = displayModel;
                inputModelOptionButtons.forEach(btn => {
                    if (btn.dataset.modelId === modelId) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
            };

            // Sidebar navigation links (Chats, Artifacts, User Profile)
            chatsSidebarLink.addEventListener('click', () => showModal('Chats', 'View your conversation history. Clicking on a chat here will load its content.'));
            artifactsSidebarLink.addEventListener('click', () => {
                showModal('Artifacts', 'Access the workspace where Claude generates and refines content like code, documents, or designs alongside your chat.');
                if (workspacePanel.classList.contains('w-0')) {
                    workspacePanel.classList.remove('w-0', 'hidden');
                    workspacePanel.classList.add('w-1/3');
                }
            });
            userProfileBtn.addEventListener('click', () => showModal('User Profile', 'Access your personal account information, subscription status, and settings.'));
            
            // Search toggle button
            searchToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebarSearchArea.classList.toggle('hidden');
                if (!sidebarSearchArea.classList.contains('hidden')) {
                    chatSearchInput.focus();
                    showModal('Search Chats', 'Toggle the search bar to find past conversations by title.');
                } else {
                    chatSearchInput.value = '';
                    renderChatList();
                    clearSearchBtn.classList.add('hidden');
                }
            });

            chatSearchInput.addEventListener('input', () => {
                const searchTerm = chatSearchInput.value.trim();
                renderChatList(searchTerm);
                if (searchTerm.length > 0) {
                    clearSearchBtn.classList.remove('hidden');
                } else {
                    clearSearchBtn.classList.add('hidden');
                }
            });

            clearSearchBtn.addEventListener('click', () => {
                chatSearchInput.value = '';
                renderChatList();
                clearSearchBtn.classList.add('hidden');
                chatSearchInput.focus();
                showModal('Search Cleared', 'Your search query has been cleared, and your full recent chat history is now displayed.');
            });

            // Input Bar Action Buttons (+ and =)
            attachButton.addEventListener('click', (e) => {
                e.stopPropagation();
                attachOptionsMenu.classList.toggle('hidden');
                // Ensure other submenus are closed
                toolsOptionsMenu.classList.add('hidden');
                inputModelOptions.classList.add('hidden');
            });

            toolsButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toolsOptionsMenu.classList.toggle('hidden');
                // Ensure other submenus are closed
                attachOptionsMenu.classList.add('hidden');
                inputModelOptions.classList.add('hidden');
            });

            submenuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = item.dataset.action;
                    // Close all submenus
                    attachOptionsMenu.classList.add('hidden');
                    toolsOptionsMenu.classList.add('hidden');
                    inputModelOptions.classList.add('hidden');

                    showModal(action, `You selected "${action}". This action would initiate that specific function (e.g., open file dialog, activate a tool mode, perform a web search).`);
                    // Optionally pre-fill prompt for simulation
                    if (action.includes("Attach files")) {
                        promptInput.value = "Attach files";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Upload folder")) {
                        promptInput.value = "Upload folder";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Take screenshot")) {
                        promptInput.value = "Take screenshot";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Use a Tool")) {
                        promptInput.value = "+ tools";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Add to Library")) {
                        promptInput.value = "Add to library";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Search the Web")) {
                        promptInput.value = "Search the web";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    } else if (action.includes("Run Deep Research")) {
                        promptInput.value = "Run deep research";
                        sendBtn.disabled = false;
                        promptInput.focus();
                    }
                });
            });

            // Contextual Quick Action Buttons (below input)
            quickActionButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // Stop propagation to prevent document click from closing modal immediately
                    const promptTrigger = button.dataset.promptTrigger;
                    promptInput.value = promptTrigger;
                    sendBtn.disabled = false;
                    promptInput.focus();
                    
                    let title = '';
                    let message = '';
                    switch (promptTrigger) {
                        case 'Write':
                            title = 'Write Assistance';
                            message = 'Pre-fills the input with a "Write" prompt, prompting Claude to assist with creative writing, drafting, or editing tasks.';
                            break;
                        case 'Learn':
                            title = 'Learning Mode';
                            message = 'Pre-fills the input with a "Learn" prompt, prompting Claude to provide explanations, summaries, or educational content on a topic.';
                            break;
                        case 'Code':
                            title = 'Code Generation & Review';
                            message = 'Pre-fills the input with a "Code" prompt, prompting Claude to assist with generating, debugging, or reviewing code.';
                            break;
                        case 'Life stuff':
                            title = 'Life Stuff Assistance';
                            message = 'Pre-fills the input with a "Life stuff" prompt, prompting Claude to help with daily tasks, personal organization, or general advice.';
                            break;
                        case "Claude's choice":
                            title = "Claude's Choice";
                            message = "Pre-fills the input with a prompt for Claude to suggest what to do next based on its capabilities or your conversation history.";
                            break;
                    }
                    showModal(title, message);
                });
            });

            closeWorkspaceBtn.addEventListener('click', () => {
                workspacePanel.classList.add('w-0', 'hidden');
                workspacePanel.classList.remove('w-1/3');
                exampleArtifact.classList.add('hidden');
                showModal('Workspace Closed', 'The Workspace/Artifacts panel has been closed.');
            });

            document.querySelectorAll('.download-artifact-btn').forEach(button => {
                button.addEventListener('click', () => {
                    showModal('Download Artifact', 'This action would simulate downloading the generated artifact (e.g., markdown file, code snippet).');
                });
            });

            // Clear localStorage for fresh start on load for demonstration
            localStorage.removeItem('claudeChatHistory');
            localStorage.removeItem('claudeActiveChatId');
            localStorage.removeItem('claudeCurrentModel');

            loadHistory();
            if (!activeChatId) {
                startNewChat();
            }
        });
    </script>
</body>
</html>
