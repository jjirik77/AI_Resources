<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Cybersecurity Career Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .details-panel {
            display: none;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
        }
        .interest-bar-bg {
            background-color: #4b5563; /* gray-600 */
        }
        .interest-bar-fill {
            background-color: #22d3ee; /* cyan-400 */
            transition: width 0.5s ease-in-out;
        }
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: #1f2937; /* gray-800 */
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="assessment-container" class="w-full max-w-5xl mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 transition-all duration-500">

        <!-- Start Screen -->
        <div id="start-screen" class="text-center fade-in">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400 mb-4">Comprehensive Cybersecurity Career Assessment</h1>
            <p class="text-gray-300 mb-6 text-lg">This two-stage assessment will first identify your core work style and then pinpoint specific cybersecurity roles you might enjoy. Discover your path in the vast world of cybersecurity.</p>
            <button id="start-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105">
                Start Profile Assessment
            </button>
        </div>

        <!-- Stage 1 Quiz Screen -->
        <div id="quiz-screen-stage1" class="hidden fade-in">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span id="question-counter-stage1" class="text-sm font-semibold text-cyan-400"></span>
                    <span id="progress-text-stage1" class="text-sm font-semibold text-gray-400"></span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div id="progress-bar-stage1" class="bg-cyan-500 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>
            <h2 class="text-2xl font-semibold mb-8 text-gray-100 text-center">Which statement is more true for you?</h2>
            <div id="answers-container-stage1" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </div>
        
        <!-- Intermediate Screen -->
        <div id="intermediate-screen" class="hidden fade-in text-center">
             <h1 class="text-3xl md:text-4xl font-bold text-cyan-400 mb-4">Profile Assessment Complete!</h1>
            <p class="text-gray-300 mb-6 text-lg">You've completed the first stage. Now, let's refine your results by exploring your interest in specific cybersecurity tasks.</p>
            <button id="start-stage2-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105">
                Start Interest Inventory
            </button>
        </div>

        <!-- Stage 2 Quiz Screen -->
        <div id="quiz-screen-stage2" class="hidden fade-in">
             <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span id="question-counter-stage2" class="text-sm font-semibold text-cyan-400"></span>
                    <span id="progress-text-stage2" class="text-sm font-semibold text-gray-400"></span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div id="progress-bar-stage2" class="bg-cyan-500 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>
            <h2 class="text-2xl font-semibold mb-6 text-gray-100 text-center">How interested are you in this activity?</h2>
            <p id="interest-question-text" class="text-center text-lg text-gray-300 mb-8"></p>
            <div id="interest-answers-container" class="flex justify-center gap-2 md:gap-4 flex-wrap"></div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden fade-in">
            <div id="confidence-banner" class="hidden p-4 mb-6 text-center text-yellow-900 bg-yellow-300 rounded-lg"></div>
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400 mb-2 text-center">Your Cybersecurity Career Explorer</h1>
            <div id="profile-summary" class="text-center mb-8"></div>
            
            <div id="top-roles-container" class="mb-10">
                 <!-- Top roles will be dynamically inserted here -->
            </div>
            
            <div id="gated-roles-container" class="hidden mb-10">
                <!-- Low confidence roles will be inserted here -->
            </div>

            <div id="top-recommendation-container" class="mb-10">
                <!-- Top recommendation category will be dynamically inserted here -->
            </div>

            <h2 class="text-2xl font-semibold text-center text-white border-t border-gray-600 pt-8 mb-6">Explore All Categories</h2>
            <div id="other-categories-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Other categories will be dynamically inserted here -->
            </div>

            <div class="text-center mt-10">
                <button id="restart-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105">
                    Take Again
                </button>
                <button id="export-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 ml-4">
                    Export Results
                </button>
            </div>
        </div>
    </div>
    
    <!-- JSON Export Modal -->
    <div id="export-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-cyan-400 mb-4">Your Assessment Data (JSON)</h2>
            <p class="text-gray-400 mb-4">You can copy the data below for your records or for further analysis.</p>
            <textarea id="json-output" readonly class="w-full h-64 p-2 bg-gray-900 text-gray-300 border border-gray-600 rounded-md font-mono text-sm"></textarea>
            <div class="mt-4 flex justify-end gap-4">
                <button id="copy-json-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-6 rounded-lg">Copy to Clipboard</button>
                <button id="close-modal-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg">Close</button>
            </div>
        </div>
    </div>


    <script>
    /**
     * Assessment Version: v2.0-high-stakes
     * Date: 2025-08-14
     * Summary of Changes:
     * - Expanded Stage 1 to 40 items across 8 traits with balanced positive/reverse keying.
     * - Implemented within-person normalization for trait scores and tie-breaker logic for primary traits.
     * - Stage 2 is now deterministic, based on primary traits, ensuring robust evidence for roles.
     * - Added new roles/activities for domains like Cloud Security, AppSec, and Red Teaming.
     * - Implemented a comprehensive FitScore (60% Interest, 30% Trait Alignment, 10% Evidence Quality).
     * - Added attention/inconsistency checks to calculate a High/Medium/Low confidence score.
     * - Results UI now gates low-confidence roles, shows actionable next steps, and includes a JSON export feature.
     * * --- README Snippet ---
     * How to Interpret Your Results:
     * - FitScore: A holistic measure of how suitable a role is for you, blending your interests and personality.
     * - Interest %: How much you liked the specific tasks associated with a role.
     * - Alignment %: How well the role's required personality profile matches your assessment results.
     * - Confidence: Our confidence in the recommendation based on the consistency of your answers and the amount of data collected.
     */
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM ELEMENTS ---
        const startScreen = document.getElementById('start-screen');
        const quizScreenStage1 = document.getElementById('quiz-screen-stage1');
        const intermediateScreen = document.getElementById('intermediate-screen');
        const quizScreenStage2 = document.getElementById('quiz-screen-stage2');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        const startStage2Btn = document.getElementById('start-stage2-btn');
        const restartBtn = document.getElementById('restart-btn');
        const exportBtn = document.getElementById('export-btn');
        const exportModal = document.getElementById('export-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const copyJsonBtn = document.getElementById('copy-json-btn');

        // --- ASSESSMENT DATA ---
        const traits = {
            ANALYTICAL: { score: 0, name: 'Analytical' }, DECISIVE: { score: 0, name: 'Decisive' }, METHODICAL: { score: 0, name: 'Methodical' },
            LEADERSHIP: { score: 0, name: 'Strategic Leadership' }, POLICY: { score: 0, name: 'Policy & Governance' }, ARCHITECTURE: { score: 0, name: 'Security Architecture' },
            DEVELOPMENT: { score: 0, name: 'Secure Development' }, EDUCATION: { score: 0, name: 'Education & Enablement' },
        };

        const frameworkCategories = {
            SP: { name: 'Securely Provision', traits: ['ARCHITECTURE', 'DEVELOPMENT'], roles: [], desc: 'Conceptualizes, designs, and builds secure IT systems.' },
            OM: { name: 'Operate and Maintain', traits: ['METHODICAL'], roles: [], desc: 'Provides the support, administration, and maintenance necessary to ensure effective and efficient IT system performance and security.' },
            OV: { name: 'Oversee and Govern', traits: ['LEADERSHIP', 'POLICY', 'EDUCATION'], roles: [], desc: 'Provides leadership, management, direction, or development and advocacy so the organization may effectively conduct cybersecurity work.' },
            PR: { name: 'Protect and Defend', traits: ['DECISIVE', 'ANALYTICAL'], roles: [], desc: 'Identifies, analyzes, and mitigates threats to internal IT systems and networks.' },
            AN: { name: 'Analyze', traits: ['ANALYTICAL'], roles: [], desc: 'Performs highly-specialized review and evaluation of incoming cybersecurity information to determine its usefulness for intelligence.' },
            IN: { name: 'Investigate', traits: ['ANALYTICAL'], roles: [], desc: 'Investigates cybersecurity events or crimes.' }
        };

        const workRoles = {
            '621': { id: '621', cat: 'SP', trait: 'DEVELOPMENT', name: 'AppSec Engineer', desc: 'Develops, creates, and modifies secure computer applications.', skills: ['Python/Go', 'SAST/DAST', 'CI/CD Pipelines'], certs: ['GWEB', 'CSSLP'], projects: ['Build a secure login form', 'Contribute to an open-source security tool'] },
            '652': { id: '652', cat: 'SP', trait: 'ARCHITECTURE', name: 'Security Architect', desc: 'Designs and builds secure IT systems and networks.', skills: ['Zero Trust', 'Network Design', 'Cloud Architecture'], certs: ['CISSP-ISSAP', 'SABSA'], projects: ['Design a secure network for a small business', 'Create a threat model for a web app'] },
            '451': { id: '451', cat: 'OM', trait: 'METHODICAL', name: 'System Administrator', desc: 'Responsible for setting up and maintaining systems.', skills: ['Linux/Windows', 'Scripting', 'Patch Management'], certs: ['RHCE', 'MCSE'], projects: ['Set up a hardened home server', 'Automate system updates with a script'] },
            '722': { id: '722', cat: 'OV', trait: 'LEADERSHIP', name: 'Security Manager', desc: 'Manages the cybersecurity of a program, organization, or system.', skills: ['Risk Management', 'Budgeting', 'Team Leadership'], certs: ['CISM', 'CISSP'], projects: ['Develop a mock incident response plan', 'Create a security budget for a fictional startup'] },
            '751': { id: '751', cat: 'OV', trait: 'EDUCATION', name: 'Security Awareness Trainer', desc: 'Develops and conducts cybersecurity training or education.', skills: ['Curriculum Design', 'Public Speaking', 'Phishing Simulation'], certs: ['Security+', 'CTP+'], projects: ['Create a 5-minute security awareness video', 'Write a blog post explaining a security concept simply'] },
            '612': { id: '612', cat: 'OV', trait: 'POLICY', name: 'GRC Analyst', desc: 'Conducts assessments of security controls to ensure compliance.', skills: ['Auditing', 'NIST/ISO Frameworks', 'GRC Tools'], certs: ['CISA', 'CRISC'], projects: ['Perform a mock audit of a personal project against a standard', 'Create a risk register for your home network'] },
            '531': { id: '531', cat: 'PR', trait: 'DECISIVE', name: 'Incident Responder', desc: 'Responds to crises to mitigate threats and recover systems.', skills: ['Forensics Tools', 'Malware Analysis', 'Calm Under Pressure'], certs: ['GCIH', 'ECIH'], projects: ['Analyze a memory dump from a compromised machine (e.g., from MemoryDD.com)', 'Participate in an online CTF event'] },
            '541': { id: '541', cat: 'PR', trait: 'ANALYTICAL', name: 'Penetration Tester', desc: 'Performs authorized tests to find and exploit vulnerabilities.', skills: ['Metasploit', 'Burp Suite', 'Exploit Development'], certs: ['OSCP', 'GPEN'], projects: ['Solve challenges on HackTheBox or TryHackMe', 'Find a bug in a public bug bounty program'] },
            '141': { id: '141', cat: 'AN', trait: 'ANALYTICAL', name: 'Threat Intelligence Analyst', desc: 'Analyzes and assesses cyber intelligence to provide warnings of threats.', skills: ['Threat Platforms', 'Data Analysis', 'Report Writing'], certs: ['CTIA', 'GCTI'], projects: ['Write a threat report on a recent malware family', 'Track the TTPs of an APT group'] },
            '212': { id: '212', cat: 'IN', trait: 'ANALYTICAL', name: 'Forensics Analyst', desc: 'Collects and analyzes digital evidence from incidents.', skills: ['EnCase/FTK', 'Memory Analysis', 'Timeline Creation'], certs: ['GCFA', 'CHFI'], projects: ['Analyze a disk image from a mock incident', 'Recover deleted files from a USB drive'] },
            'CSPE': { id: 'CSPE', cat: 'OM', trait: 'METHODICAL', name: 'Cloud Security Engineer', desc: 'Secures and maintains cloud environments (e.g., AWS, Azure, GCP).', skills: ['IAM', 'Terraform', 'CSPM/CWPP Tools'], certs: ['CCSP', 'Azure Security Engineer'], projects: ['Build a secure VPC in AWS', 'Write an infrastructure-as-code script to deploy a hardened server'] },
            'IAM': { id: 'IAM', cat: 'OM', trait: 'METHODICAL', name: 'Identity & Access Engineer', desc: 'Manages identity lifecycle, authentication, and authorization.', skills: ['Okta/Azure AD', 'SAML/OAuth', 'PAM solutions'], certs: ['Okta Certified Professional', 'SC-300'], projects: ['Set up multi-factor authentication on all your personal accounts', 'Build a simple app with social login'] },
            'VULN': { id: 'VULN', cat: 'PR', trait: 'METHODICAL', name: 'Vulnerability Manager', desc: 'Manages the lifecycle of vulnerabilities from discovery to remediation.', skills: ['Tenable/Qualys', 'Risk Prioritization', 'Communication'], certs: ['Security+', 'Tenable Certified Specialist'], projects: ['Run a vulnerability scan on your home network', 'Prioritize a list of mock vulnerabilities based on impact'] },
        };
        
        Object.values(workRoles).forEach(role => {
            if(frameworkCategories[role.cat]) frameworkCategories[role.cat].roles.push(role);
        });

        // 40 items, 5 per trait (3 pos, 2 rev)
        const stage1Questions = [
            // ANALYTICAL
            { id: 1, a: { text: "I enjoy deep-diving into logs and data to find the root cause of a problem.", trait: 'ANALYTICAL' }, b: { text: "I prefer to act quickly based on the information at hand.", trait: 'DECISIVE' } },
            { id: 2, a: { text: "I'd rather be a detective, solving a complex digital mystery.", trait: 'ANALYTICAL' }, b: { text: "I'd rather be a firefighter, controlling a digital emergency.", trait: 'DECISIVE' } },
            { id: 3, a: { text: "Finding a single, critical flaw in a system is deeply satisfying.", trait: 'ANALYTICAL' }, b: { text: "Ensuring a system meets all compliance standards is deeply satisfying.", trait: 'POLICY' } },
            { id: 4, a: { text: "I prefer to move on once a problem's surface symptoms are fixed.", trait: 'ANALYTICAL', rev: true }, b: { text: "I need to understand the fundamental reason why a problem occurred.", trait: 'ANALYTICAL' } }, // rev
            { id: 5, a: { text: "I'm comfortable making decisions with incomplete data.", trait: 'ANALYTICAL', rev: true }, b: { text: "I require thorough data analysis before making a decision.", trait: 'ANALYTICAL' } }, // rev
            // DECISIVE
            { id: 6, a: { text: "I thrive in dynamic environments where priorities change at a moment's notice.", trait: 'DECISIVE' }, b: { text: "I enjoy work that has a predictable rhythm and a structured process.", trait: 'METHODICAL' } },
            { id: 7, a: { text: "I'm energized by a high-stakes, time-sensitive operation.", trait: 'DECISIVE' }, b: { text: "I'm energized by managing a long-term project or team.", trait: 'LEADERSHIP' } },
            { id: 8, a: { text: "It's more important to start quickly and adapt the plan as you go.", trait: 'DECISIVE' }, b: { text: "It's more important to have a perfect, comprehensive plan before starting.", trait: 'ARCHITECTURE' } },
            { id: 9, a: { text: "I prefer to think through every possible outcome before acting.", trait: 'DECISIVE', rev: true }, b: { text: "I am biased toward action, even with some uncertainty.", trait: 'DECISIVE' } }, // rev
            { id: 10, a: { text: "In a crisis, I tend to freeze and over-analyze.", trait: 'DECISIVE', rev: true }, b: { text: "In a crisis, I become focused and take charge.", trait: 'DECISIVE' } }, // rev
            // METHODICAL
            { id: 11, a: { text: "I prefer ensuring an existing system is running perfectly and securely.", trait: 'METHODICAL' }, b: { text: "I enjoy building a new system from scratch.", trait: 'DEVELOPMENT' } },
            { id: 12, a: { text: "A successful day is when I've followed my checklist and completed all my tasks.", trait: 'METHODICAL' }, b: { text: "A successful day is when I've discovered something new and unexpected.", trait: 'ANALYTICAL' } },
            { id: 13, a: { text: "I feel frustrated when people don't follow established protocols.", trait: 'METHODICAL' }, b: { text: "I feel frustrated when rigid protocols get in the way of solving a problem efficiently.", trait: 'DECISIVE' } },
            { id: 14, a: { text: "I often find myself bending the rules to get the job done faster.", trait: 'METHODICAL', rev: true }, b: { text: "I believe in following the process, even if it's slower.", trait: 'METHODICAL' } }, // rev
            { id: 15, a: { text: "I find detailed documentation and record-keeping to be tedious.", trait: 'METHODICAL', rev: true }, b: { text: "I find detailed documentation and record-keeping to be satisfying.", trait: 'METHODICAL' } }, // rev
            // LEADERSHIP
            { id: 16, a: { text: "My strength is in leading a team and setting a vision.", trait: 'LEADERSHIP' }, b: { text: "My strength is in being a key technical expert on a team.", trait: 'DEVELOPMENT' } },
            { id: 17, a: { text: "I am more concerned with 'Why should we be doing this?'", trait: 'LEADERSHIP' }, b: { text: "I am more concerned with 'How does this work?'", trait: 'ANALYTICAL' } },
            { id: 18, a: { text: "I prefer to think about long-term risks and strategy.", trait: 'LEADERSHIP' }, b: { text: "I prefer to focus on immediate, tangible problems.", trait: 'DECISIVE' } },
            { id: 19, a: { text: "I prefer to let others handle the budget and resource planning.", trait: 'LEADERSHIP', rev: true }, b: { text: "I enjoy handling the budget and resource planning for a project.", trait: 'LEADERSHIP' } }, // rev
            { id: 20, a: { text: "I find developing long-range strategic plans to be boring.", trait: 'LEADERSHIP', rev: true }, b: { text: "I find developing long-range strategic plans to be exciting.", trait: 'LEADERSHIP' } }, // rev
            // POLICY
            { id: 21, a: { text: "I enjoy creating rules and governance structures.", trait: 'POLICY' }, b: { text: "I enjoy finding ways to legally bypass rules and structures.", trait: 'ANALYTICAL' } },
            { id: 22, a: { text: "I enjoy documenting my work meticulously for auditing.", trait: 'POLICY' }, b: { text: "I prefer to move on to the next challenge once a problem is solved.", trait: 'DECISIVE' } },
            { id: 23, a: { text: "The most important thing is to be correct and compliant.", trait: 'POLICY' }, b: { text: "The most important thing is to be effective and innovative.", trait: 'ARCHITECTURE' } },
            { id: 24, a: { text: "I think rules should be flexible and open to interpretation.", trait: 'POLICY', rev: true }, b: { text: "I think rules should be clear and consistently enforced.", trait: 'POLICY' } }, // rev
            { id: 25, a: { text: "I'm not very interested in the legal or regulatory aspects of technology.", trait: 'POLICY', rev: true }, b: { text: "I am fascinated by the legal and regulatory aspects of technology.", trait: 'POLICY' } }, // rev
            // ARCHITECTURE
            { id: 26, a: { text: "I enjoy designing a high-level blueprint for a system.", trait: 'ARCHITECTURE' }, b: { text: "I enjoy the hands-on process of writing the code for a system.", trait: 'DEVELOPMENT' } },
            { id: 27, a: { text: "I think in terms of systems, frameworks, and how pieces connect.", trait: 'ARCHITECTURE' }, b: { text: "I think in terms of evidence, logs, and specific artifacts.", trait: 'ANALYTICAL' } },
            { id: 28, a: { text: "I'd rather design the security for an application than code it.", trait: 'ARCHITECTURE' }, b: { text: "I'd rather code a secure application than design it.", trait: 'DEVELOPMENT' } },
            { id: 29, a: { text: "I prefer to focus on one component at a time, not the whole system.", trait: 'ARCHITECTURE', rev: true }, b: { text: "I always have to understand the whole system before I can focus on a component.", trait: 'ARCHITECTURE' } }, // rev
            { id: 30, a: { text: "I find abstract design and theory to be impractical.", trait: 'ARCHITECTURE', rev: true }, b: { text: "I believe a strong abstract design is the key to practical success.", trait: 'ARCHITECTURE' } }, // rev
            // DEVELOPMENT
            { id: 31, a: { text: "I am more interested in writing code for computers.", trait: 'DEVELOPMENT' }, b: { text: "I am more interested in creating training programs for people.", trait: 'EDUCATION' } },
            { id: 32, a: { text: "When learning a new tool, I start using it and learn by doing.", trait: 'DEVELOPMENT' }, b: { text: "When learning a new tool, I read the manual first.", trait: 'METHODICAL' } },
            { id: 33, a: { text: "I get more satisfaction from building something new than from analyzing something old.", trait: 'DEVELOPMENT' }, b: { text: "I get more satisfaction from analyzing something old than from building something new.", trait: 'ANALYTICAL' } },
            { id: 34, a: { text: "I'm not a 'hands-on' technical person.", trait: 'DEVELOPMENT', rev: true }, b: { text: "I am a very 'hands-on' technical person.", trait: 'DEVELOPMENT' } }, // rev
            { id: 35, a: { text: "I find debugging code to be a frustrating chore.", trait: 'DEVELOPMENT', rev: true }, b: { text: "I find debugging code to be a satisfying puzzle.", trait: 'DEVELOPMENT' } }, // rev
            // EDUCATION
            { id: 36, a: { text: "I am skilled at explaining complex technical details to others.", trait: 'EDUCATION' }, b: { text: "I prefer to keep my technical knowledge to myself.", trait: 'ANALYTICAL' } },
            { id: 37, a: { text: "I enjoy teaching and mentoring others.", trait: 'EDUCATION' }, b: { text: "I prefer working independently on technical challenges.", trait: 'DEVELOPMENT' } },
            { id: 38, a: { text: "I believe changing people's behavior is the key to security.", trait: 'EDUCATION' }, b: { text: "I believe technology is the key to security.", trait: 'ARCHITECTURE' } },
            { id: 39, a: { text: "I dislike public speaking or presenting to groups.", trait: 'EDUCATION', rev: true }, b: { text: "I am comfortable with public speaking and presenting to groups.", trait: 'EDUCATION' } }, // rev
            { id: 40, a: { text: "I'd rather write a technical document than a training manual.", trait: 'EDUCATION', rev: true }, b: { text: "I'd rather write a training manual than a technical document.", trait: 'EDUCATION' } }, // rev
        ];

        const interestQuestionsByTrait = {
            DEVELOPMENT: [{ text: "Writing and testing secure code for a new application.", roles: ['621'] }],
            ARCHITECTURE: [{ text: "Designing the security architecture for a new enterprise network.", roles: ['652'] }],
            METHODICAL: [{ text: "Managing user accounts and system patches on servers.", roles: ['451']}, { text: "Securing and maintaining a large cloud environment (AWS, Azure, etc.).", roles: ['CSPE']}, { text: "Managing the lifecycle of vulnerabilities from discovery to remediation.", roles: ['VULN'] }, { text: "Managing identity lifecycle, authentication, and authorization.", roles: ['IAM'] }],
            LEADERSHIP: [{ text: "Managing the budget and roadmap for a cybersecurity department.", roles: ['722'] }],
            POLICY: [{ text: "Auditing a cloud environment to ensure it meets compliance standards like ISO 27001.", roles: ['612'] }, { text: "Drafting a formal policy on acceptable use of company IT resources.", roles: ['701'] }],
            EDUCATION: [{ text: "Developing a company-wide cybersecurity training program.", roles: ['751'] }],
            DECISIVE: [{ text: "Coordinating the response to a live ransomware attack.", roles: ['531'] }, { text: "Actively monitoring security alerts and responding to potential threats in real-time.", roles: ['511'] }],
            ANALYTICAL: [{ text: "Performing a deep-dive forensic analysis of a compromised hard drive.", roles: ['212'] }, { text: "Analyzing intelligence reports to predict future cyber threats.", roles: ['141'] }, { text: "Performing authorized penetration tests to find vulnerabilities.", roles: ['541'] }]
        };

        let currentStage1Index = 0;
        let currentStage2Index = 0;
        let stage2QuestionSet = [];
        let interestScores = {};
        let maxInterestScores = {};
        let userPrimaryTraits = [];
        let allRolesWithScores = [];
        let telemetryData = {};

        function init() {
            startBtn.addEventListener('click', startStage1);
            startStage2Btn.addEventListener('click', startStage2);
            restartBtn.addEventListener('click', () => {
                resultsScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            });
            exportBtn.addEventListener('click', showExportModal);
            closeModalBtn.addEventListener('click', () => exportModal.classList.add('hidden'));
            copyJsonBtn.addEventListener('click', copyJsonToClipboard);
        }

        function startStage1() {
            startScreen.classList.add('hidden');
            quizScreenStage1.classList.remove('hidden');
            currentStage1Index = 0;
            telemetryData = { stage1: [] };
            Object.values(traits).forEach(trait => trait.score = 0);
            showStage1Question();
        }

        function showStage1Question() {
            const container = document.getElementById('answers-container-stage1');
            container.innerHTML = '';

            if (currentStage1Index < stage1Questions.length) {
                const question = stage1Questions[currentStage1Index];
                const progress = ((currentStage1Index) / stage1Questions.length) * 100;
                document.getElementById('progress-bar-stage1').style.width = `${progress}%`;
                document.getElementById('question-counter-stage1').textContent = `Question ${currentStage1Index + 1} of ${stage1Questions.length}`;
                document.getElementById('progress-text-stage1').textContent = `Profile Assessment: ${Math.round(progress)}% Complete`;
                const startTime = performance.now();

                ['a', 'b'].forEach(choice => {
                    const button = document.createElement('button');
                    button.setAttribute('role', 'button');
                    button.setAttribute('tabindex', '0');
                    button.className = "flex items-center justify-center text-center p-6 bg-gray-700 rounded-lg hover:bg-cyan-700 hover:ring-2 hover:ring-cyan-400 transition-all duration-200 h-full";
                    button.innerHTML = `<span class="text-gray-200 text-lg">${question[choice].text}</span>`;
                    const clickHandler = () => {
                        const endTime = performance.now();
                        const latency = endTime - startTime;
                        selectStage1Answer(question, choice, latency);
                    };
                    button.onclick = clickHandler;
                    button.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') clickHandler(); };
                    container.appendChild(button);
                });
            } else {
                quizScreenStage1.classList.add('hidden');
                intermediateScreen.classList.remove('hidden');
            }
        }

        function selectStage1Answer(question, choice, latency) {
            const selected = question[choice];
            const unselected = question[choice === 'a' ? 'b' : 'a'];
            
            // Add score
            if (selected.rev) {
                if(traits[unselected.trait]) traits[unselected.trait].score += 1;
            } else {
                if(traits[selected.trait]) traits[selected.trait].score += 1;
            }
            
            telemetryData.stage1.push({
                questionId: question.id,
                selection: choice,
                latency: Math.round(latency)
            });

            currentStage1Index++;
            showStage1Question();
        }

        function startStage2() {
            intermediateScreen.classList.add('hidden');
            quizScreenStage2.classList.remove('hidden');
            
            telemetryData.stage1RawScores = Object.fromEntries(Object.entries(traits).map(([k, v]) => [k, v.score]));
            telemetryData.stage1NormalizedScores = normalizeTraitScores(traits);

            const sortedTraits = Object.entries(telemetryData.stage1NormalizedScores).sort(([,a],[,b]) => b - a);
            userPrimaryTraits = [sortedTraits[0][0]];
            if (sortedTraits.length > 1 && sortedTraits[0][1] - sortedTraits[1][1] <= 1) {
                userPrimaryTraits.push(sortedTraits[1][0]);
            }
            if (userPrimaryTraits.length === 2 && sortedTraits.length > 2 && sortedTraits[0][1] - sortedTraits[2][1] <= 2) {
                 userPrimaryTraits.push(sortedTraits[2][0]);
            }
            telemetryData.primaryTraits = userPrimaryTraits;

            stage2QuestionSet = [];
            userPrimaryTraits.forEach(trait => {
                if (interestQuestionsByTrait[trait]) stage2QuestionSet.push(...interestQuestionsByTrait[trait]);
            });
            
            const otherTraits = Object.keys(interestQuestionsByTrait).filter(t => !userPrimaryTraits.includes(t));
            otherTraits.forEach(trait => {
                if(interestQuestionsByTrait[trait]?.[0]) stage2QuestionSet.push(interestQuestionsByTrait[trait][0]);
            });
            stage2QuestionSet = [...new Set(stage2QuestionSet)];

            // Add attention checks
            const attentionChecks = [
                { text: "For this item, please select 'Slightly' to ensure you are paying attention.", roles: [], check: true, expectedValue: 1 },
                { text: "Please select 'Very' for this item.", roles: [], check: true, expectedValue: 3 },
                { text: "To continue, please select the 'Moderately' option.", roles: [], check: true, expectedValue: 2 }
            ];
            for (let i = 0; i < 3; i++) {
                stage2QuestionSet.splice(Math.floor(stage2QuestionSet.length / (3 - i + 1)) * (i + 1), 0, attentionChecks[i]);
            }

            currentStage2Index = 0;
            interestScores = {};
            maxInterestScores = {};
            telemetryData.stage2 = [];
            telemetryData.attentionFailed = false;

            Object.keys(workRoles).forEach(id => {
                interestScores[id] = 0;
                maxInterestScores[id] = 0;
            });

            stage2QuestionSet.forEach(q => {
                if (!q.check) {
                    q.roles.forEach(roleId => {
                        if (maxInterestScores[roleId] !== undefined) maxInterestScores[roleId] += 3;
                    });
                }
            });

            showStage2Question();
        }

        function showStage2Question() {
            if (currentStage2Index < stage2QuestionSet.length) {
                const question = stage2QuestionSet[currentStage2Index];
                document.getElementById('interest-question-text').textContent = question.text;
                
                const progress = ((currentStage2Index) / stage2QuestionSet.length) * 100;
                document.getElementById('progress-bar-stage2').style.width = `${progress}%`;
                document.getElementById('question-counter-stage2').textContent = `Activity ${currentStage2Index + 1} of ${stage2QuestionSet.length}`;
                document.getElementById('progress-text-stage2').textContent = `Interest Inventory: ${Math.round(progress)}% Complete`;

                const container = document.getElementById('interest-answers-container');
                container.innerHTML = '';
                const ratings = [
                    { text: 'Not Interested', value: 0 }, { text: 'Slightly', value: 1 },
                    { text: 'Moderately', value: 2 }, { text: 'Very', value: 3 }
                ];
                ratings.forEach(rating => {
                    const button = document.createElement('button');
                    button.className = "bg-gray-600 hover:bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg transition-all";
                    button.textContent = rating.text;
                    button.onclick = () => selectStage2Answer(question, rating.value);
                    container.appendChild(button);
                });
            } else {
                showResults();
            }
        }

        function selectStage2Answer(question, value) {
            if (question.check && value !== question.expectedValue) {
                telemetryData.attentionFailed = true;
            }
            if (!question.check) {
                question.roles.forEach(roleId => {
                    if(interestScores[roleId] !== undefined) interestScores[roleId] += value;
                });
            }
            telemetryData.stage2.push({ question: question.text, response: value });
            currentStage2Index++;
            showStage2Question();
        }
        
        // --- SCORING & UTILITY FUNCTIONS ---
        function normalizeTraitScores(traitsObj) {
            const scores = Object.values(traitsObj).map(t => t.score);
            const min = Math.min(...scores);
            const max = Math.max(...scores);
            if (max === min) return Object.fromEntries(Object.keys(traitsObj).map(k => [k, 100]));
            
            const normalized = {};
            for (const key in traitsObj) {
                normalized[key] = Math.round(((traitsObj[key].score - min) / (max - min)) * 100);
            }
            return normalized;
        }

        function computeAlignment(roleTrait, userTraitProfile) {
            const { normalizedScores, primaryTraits } = userTraitProfile;
            const sortedTraits = Object.entries(normalizedScores).sort(([,a],[,b]) => b - a);
            const secondaryTrait = (primaryTraits.length > 1 && sortedTraits.length > 1) ? sortedTraits[1][0] : null;
            const top3Traits = sortedTraits.slice(0, 3).map(t => t[0]);

            if (primaryTraits.includes(roleTrait)) return 100;
            if (roleTrait === secondaryTrait) return 80;
            if (top3Traits.includes(roleTrait)) return 60;
            
            const roleCategory = Object.values(frameworkCategories).find(cat => cat.roles.some(r => r.trait === roleTrait));
            if (roleCategory && roleCategory.traits.some(t => top3Traits.includes(t))) return 40;
            
            return 20;
        }

        function computeEvidenceQuality(evidenceCount, attentionFailed) {
            let quality = 0;
            if (evidenceCount >= 6) quality = 100;
            else if (evidenceCount >= 4) quality = 80;
            else if (evidenceCount === 3) quality = 60;
            else if (evidenceCount === 2) quality = 40;
            
            if (attentionFailed) quality = Math.max(0, quality - 30);
            return quality;
        }

        function computeFitScore(interestPct, alignmentPct, evidenceQuality) {
            return (interestPct * 0.6) + (alignmentPct * 0.3) + (evidenceQuality * 0.1);
        }

        function computeConfidence(evidenceCount, attentionFailed) {
            if (attentionFailed || evidenceCount < 3) return "Low";
            if (evidenceCount >= 5) return "High";
            return "Medium";
        }

        function getProfile() {
            const profiles = {
                ANALYTICAL: { title: "The Digital Detective", desc: "You are driven by logic and evidence. You excel at deep investigation and finding patterns others miss." },
                DECISIVE: { title: "The First Responder", desc: "You are action-oriented and thrive under pressure. You excel at making quick, critical decisions." },
                METHODICAL: { title: "The Systems Guardian", desc: "You are structured and process-driven. You excel at building and verifying defenses and ensuring systems adhere to standards." },
                LEADERSHIP: { title: "The Strategic Leader", desc: "You are a big-picture thinker focused on long-term planning, team direction, and governance." },
                POLICY: { title: "The GRC Specialist", desc: "You focus on governance, risk, and compliance, ensuring operations align with standards and regulations." },
                ARCHITECTURE: { title: "The Security Architect", desc: "You enjoy designing resilient, high-level systems and frameworks from the ground up." },
                DEVELOPMENT: { title: "The Secure Developer", desc: "You are a creative problem-solver who enjoys the hands-on process of building secure applications." },
                EDUCATION: { title: "The Cyber Educator", desc: "You are skilled at translating complex topics. You excel at creating policy, training programs, and fostering a culture of security." }
            };
            
            let title = userPrimaryTraits.map(t => profiles[t].title).join(' / ');
            let description = userPrimaryTraits.map(t => profiles[t].desc).join(' You also show strong tendencies of the second profile. ');
            return { title, description };
        }

        function showResults() {
            quizScreenStage2.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            const userProfile = getProfile();
            document.getElementById('profile-summary').innerHTML = `
                <h2 class="text-2xl font-semibold text-white">${userProfile.title}</h2>
                <p class="text-gray-300 mt-2 max-w-3xl mx-auto">${userProfile.description}</p>
            `;

            const topRolesContainer = document.getElementById('top-roles-container');
            const gatedRolesContainer = document.getElementById('gated-roles-container');
            const topRecContainer = document.getElementById('top-recommendation-container');
            const otherCatContainer = document.getElementById('other-categories-container');
            topRolesContainer.innerHTML = '';
            gatedRolesContainer.innerHTML = '';
            topRecContainer.innerHTML = '';
            otherCatContainer.innerHTML = '';

            const userTraitProfile = { normalizedScores: telemetryData.stage1NormalizedScores, primaryTraits: userPrimaryTraits };
            allRolesWithScores = Object.values(workRoles).map(role => {
                const evidenceCount = stage2QuestionSet.filter(q => !q.check && q.roles.includes(role.id)).length;
                const assessed = evidenceCount >= 3;
                const interestPercentage = maxInterestScores[role.id] > 0 ? (interestScores[role.id] / maxInterestScores[role.id]) * 100 : 0;
                const alignmentPercentage = computeAlignment(role.trait, userTraitProfile);
                const evidenceQuality = computeEvidenceQuality(evidenceCount, telemetryData.attentionFailed);
                const fitScore = computeFitScore(interestPercentage, alignmentPercentage, evidenceQuality);
                const confidence = computeConfidence(evidenceCount, telemetryData.attentionFailed);
                return { ...role, interestPercentage, fitScore, assessed, confidence, alignmentPercentage, evidenceQuality, evidenceCount };
            });

            // Render Top Roles
            const topRoles = allRolesWithScores.filter(r => r.assessed && r.confidence !== 'Low').sort((a,b) => b.fitScore - a.fitScore).slice(0,3);
            let topRolesHtml = `<h2 class="text-2xl font-bold text-cyan-400 mb-4 text-center">Your Top Roles by Fit Score</h2><div class="space-y-3">`;
            topRoles.forEach(role => topRolesHtml += createRoleCard(role));
            topRolesContainer.innerHTML = topRolesHtml + `</div>`;

            // Render Gated Roles
            const gatedRoles = allRolesWithScores.filter(r => !topRoles.includes(r) && (r.confidence === 'Low' || !r.assessed));
            if (gatedRoles.length > 0) {
                gatedRolesContainer.classList.remove('hidden');
                let gatedHtml = `<h3 class="text-xl font-semibold text-center text-yellow-400 mb-4">Roles Needing More Data</h3><div class="space-y-2">`;
                gatedRoles.forEach(role => gatedHtml += createRoleCard(role, true));
                gatedRolesContainer.innerHTML = gatedHtml + `</div>`;
            }

            // Render Categories
            const topCategories = Object.values(frameworkCategories).filter(cat => cat.traits.some(t => userPrimaryTraits.includes(t)));
            const otherCategories = Object.values(frameworkCategories).filter(cat => !cat.traits.some(t => userPrimaryTraits.includes(t)));
            topCategories.forEach(category => topRecContainer.appendChild(createCategoryCard(category, true)));
            otherCategories.forEach(category => otherCatContainer.appendChild(createCategoryCard(category, false)));
            
            if (telemetryData.attentionFailed) {
                const banner = document.getElementById('confidence-banner');
                banner.classList.remove('hidden');
                banner.textContent = "Your results may be less accurate because an attention check was missed. We recommend retaking the assessment for the highest confidence.";
            }
        }

        function createRoleCard(role, isGated = false) {
            let interestDisplayHtml = '';
            if (role.evidenceCount < 3) {
                 interestDisplayHtml = `<div class="flex items-center h-5"><span class="text-xs font-medium text-gray-500">Interest: Not Assessed (Insufficient Data)</span></div>`;
            } else {
                 interestDisplayHtml = `<div class="flex items-center"><span class="text-xs font-medium text-gray-300 mr-2 w-20">Interest:</span><div class="w-full interest-bar-bg rounded-full h-2.5"><div class="interest-bar-fill h-2.5 rounded-full" style="width: ${role.interestPercentage}%"></div></div></div>`;
            }
            
            const confidenceColor = role.confidence === 'High' ? 'text-green-400' : role.confidence === 'Medium' ? 'text-yellow-400' : 'text-red-400';

            return `
                <div class="p-4 bg-gray-700 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-white text-lg">${role.name}</h4>
                            <p class="text-xs text-gray-400 mb-2">${role.desc}</p>
                        </div>
                        <div class="text-right ml-2">
                             <span class="text-sm font-bold text-cyan-300 block">Fit: ${Math.round(role.fitScore)}%</span>
                             <span class="text-xs ${confidenceColor}">Confidence: ${role.confidence}</span>
                        </div>
                    </div>
                    ${interestDisplayHtml}
                </div>`;
        }

        function createCategoryCard(category, isRecommended) {
            const card = document.createElement('div');
            card.className = `framework-card bg-gray-700 p-4 rounded-lg border-2 border-transparent ${isRecommended ? 'recommended' : 'cursor-pointer hover:border-gray-600'}`;
            
            let rolesHtml = '';
            const sortedRoles = category.roles.map(role => allRolesWithScores.find(r => r.id === role.id)).filter(Boolean).sort((a,b) => b.fitScore - a.fitScore);

            sortedRoles.forEach(role => {
                const detailsId = `details-${role.id}`;
                let interestDisplayHtml = '';
                if (role.evidenceCount < 3) {
                    interestDisplayHtml = `<div class="flex items-center h-5"><span class="text-xs font-medium text-gray-500 mr-2 w-20">Interest:</span><span class="text-xs text-gray-500">Not Assessed</span></div>`;
                } else {
                    interestDisplayHtml = `<div class="flex items-center"><span class="text-xs font-medium text-cyan-300 mr-2 w-20">Interest:</span><div class="w-full interest-bar-bg rounded-full h-2.5"><div class="interest-bar-fill h-2.5 rounded-full" style="width: ${role.interestPercentage}%"></div></div></div>`;
                }

                rolesHtml += `
                    <div class="p-3 bg-gray-800 rounded">
                        <h4 class="font-semibold text-white cursor-pointer" onclick="toggleDetails('${detailsId}')">${role.name} <span class="text-xs font-normal text-gray-400">(Fit: ${Math.round(role.fitScore)}%)</span></h4>
                        ${interestDisplayHtml}
                        <div id="${detailsId}" class="details-panel text-xs text-gray-400 mt-2 border-t border-gray-600 pt-2">
                            <strong>Skills to Build:</strong> ${role.skills.join(', ')}<br>
                            <strong>Common Certs:</strong> ${role.certs.join(', ')}<br>
                            <strong>Starter Projects:</strong> ${role.projects.join(', ')}
                        </div>
                    </div>`;
            });

            const titleHtml = isRecommended ? `<h2 class="text-2xl font-bold text-cyan-400 mb-1">Your Top Category Match(es)</h2><h3 class="text-xl font-semibold text-white">${category.name}</h3>` : `<h3 class="text-xl font-bold text-cyan-400">${category.name}</h3>`;
            card.innerHTML = `${titleHtml}<p class="text-sm text-gray-400 mb-4">${category.desc}</p><div class="space-y-3">${rolesHtml}</div>`;
            return card;
        }
        
        function showExportModal() {
            telemetryData.finalResults = allRolesWithScores;
            document.getElementById('json-output').value = JSON.stringify(telemetryData, null, 2);
            exportModal.classList.remove('hidden');
        }

        function copyJsonToClipboard() {
            const jsonOutput = document.getElementById('json-output');
            jsonOutput.select();
            document.execCommand('copy');
            copyJsonBtn.textContent = "Copied!";
            setTimeout(() => { copyJsonBtn.textContent = "Copy to Clipboard"; }, 2000);
        }

        window.toggleDetails = function(id) {
            const panel = document.getElementById(id);
            if (panel.style.display === 'block') {
                panel.style.maxHeight = '0';
                setTimeout(() => { panel.style.display = 'none'; }, 500);
            } else {
                panel.style.display = 'block';
                panel.style.maxHeight = panel.scrollHeight + "px";
            }
        }

        init();
    });
    </script>
</body>
</html>
